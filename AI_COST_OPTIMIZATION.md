# AI 비용 효율적 구현 전략

## 가격 비교 (2024-2025 기준)

### OpenAI
- **GPT-4 Turbo (Vision)**: 입력 $0.01/1K tokens, 출력 $0.03/1K tokens
- **GPT-4o (Vision)**: 입력 $0.005/1K tokens, 출력 $0.015/1K tokens (더 저렴)
- **GPT-3.5 Turbo**: 입력 $0.0005/1K tokens, 출력 $0.0015/1K tokens (가장 저렴)

### Google
- **Gemini 1.5 Pro (Vision)**: 입력 $0.0005/1K tokens, 출력 $0.0015/1K tokens
- **Gemini 1.5 Flash**: 입력 $0.000075/1K tokens, 출력 $0.0003/1K tokens (매우 저렴)

## 3단계 파이프라인별 최적 모델 선택

### 단계 A (Vision AI) - 사진 분석

**요구사항:**
- 이미지 분석 (피부 문제 탐지)
- 정량화 (점수, 퍼센트)
- 마스크/좌표 생성
- Heatmap 생성

**비용 효율적 선택:**

#### 옵션 1: Google Gemini 1.5 Pro (Vision) ⭐ **추천**
- **비용**: 입력 $0.0005/1K tokens, 출력 $0.0015/1K tokens
- **장점**: 
  - OpenAI보다 **20배 저렴** (GPT-4o 대비)
  - Vision 기능 우수
  - 긴 컨텍스트 윈도우 (2M tokens)
- **단점**: 
  - OpenAI보다 약간 낮은 정확도 (하지만 충분히 사용 가능)
- **예상 비용**: 이미지 1개당 약 $0.01-0.02

#### 옵션 2: OpenAI GPT-4o (Vision)
- **비용**: 입력 $0.005/1K tokens, 출력 $0.015/1K tokens
- **장점**: 
  - 가장 높은 정확도
  - 안정적인 API
- **단점**: 
  - Gemini보다 **10배 비쌈**
- **예상 비용**: 이미지 1개당 약 $0.10-0.20

**결론**: **Google Gemini 1.5 Pro (Vision)** 추천 (비용 대비 성능 우수)

---

### 단계 B (Mapping AI) - 문제 → 시술 매핑

**요구사항:**
- 규칙 기반 필터링 (안전성/금기)
- 통계 기반 가중치 계산
- 시술 후보 추천

**비용 효율적 선택:**

#### 옵션 1: 규칙 엔진 (Rule Engine) ⭐ **추천**
- **비용**: **$0** (서버 로직)
- **장점**: 
  - 완전 무료
  - 빠른 응답 속도
  - 완전한 제어 가능
  - 설명 가능성 (explainability)
- **구현**: 
  - JavaScript/TypeScript 규칙 엔진
  - 가중치 테이블 기반 점수 계산
- **예상 비용**: $0

#### 옵션 2: Google Gemini 1.5 Flash (경량 LLM)
- **비용**: 입력 $0.000075/1K tokens, 출력 $0.0003/1K tokens
- **장점**: 
  - 매우 저렴 (거의 무료 수준)
  - 유연한 규칙 적용 가능
- **단점**: 
  - 규칙 엔진보다 느림
  - 설명 가능성 낮음
- **예상 비용**: 요청 1개당 약 $0.0001-0.0005

#### 옵션 3: OpenAI GPT-3.5 Turbo
- **비용**: 입력 $0.0005/1K tokens, 출력 $0.0015/1K tokens
- **장점**: 
  - 안정적인 API
- **단점**: 
  - 규칙 엔진보다 비쌈
  - Gemini Flash보다 비쌈
- **예상 비용**: 요청 1개당 약 $0.001-0.002

**결론**: **규칙 엔진 (Rule Engine)** 추천 (무료 + 빠름 + 제어 가능)

**하이브리드 접근**: 규칙 엔진 + 통계 기반 가중치 (ML 모델 없이)

---

### 단계 C (NLG AI) - 사용자 친화 문구 생성

**요구사항:**
- 자연스러운 한국어 문구 생성
- 법적 면책 문구 포함
- 금지어 필터링
- 친절한 톤

**비용 효율적 선택:**

#### 옵션 1: Google Gemini 1.5 Flash ⭐ **추천**
- **비용**: 입력 $0.000075/1K tokens, 출력 $0.0003/1K tokens
- **장점**: 
  - 매우 저렴 (거의 무료 수준)
  - 한국어 지원 우수
  - 빠른 응답 속도
- **단점**: 
  - GPT-4o보다 약간 낮은 품질 (하지만 충분히 사용 가능)
- **예상 비용**: 요청 1개당 약 $0.0001-0.0003

#### 옵션 2: OpenAI GPT-3.5 Turbo
- **비용**: 입력 $0.0005/1K tokens, 출력 $0.0015/1K tokens
- **장점**: 
  - 안정적인 API
  - 한국어 지원 우수
- **단점**: 
  - Gemini Flash보다 **6-7배 비쌈**
- **예상 비용**: 요청 1개당 약 $0.001-0.002

#### 옵션 3: OpenAI GPT-4o
- **비용**: 입력 $0.005/1K tokens, 출력 $0.015/1K tokens
- **장점**: 
  - 가장 높은 품질
- **단점**: 
  - 매우 비쌈 (Gemini Flash 대비 **200배**)
- **예상 비용**: 요청 1개당 약 $0.01-0.02

**결론**: **Google Gemini 1.5 Flash** 추천 (비용 대비 성능 우수)

---

## 최종 추천 조합 (비용 효율적)

### 조합 1: 최저 비용 ⭐ **추천**

| 단계 | 모델 | 비용 (1회 요청) | 총 비용 |
|------|------|----------------|---------|
| A (Vision) | Google Gemini 1.5 Pro | $0.01-0.02 | |
| B (Mapping) | 규칙 엔진 (Rule Engine) | $0 | |
| C (NLG) | Google Gemini 1.5 Flash | $0.0001-0.0003 | |
| **총계** | | | **$0.01-0.02** |

**월 1,000건 기준**: 약 **$10-20/월**

### 조합 2: 균형 (비용 + 품질)

| 단계 | 모델 | 비용 (1회 요청) | 총 비용 |
|------|------|----------------|---------|
| A (Vision) | Google Gemini 1.5 Pro | $0.01-0.02 | |
| B (Mapping) | 규칙 엔진 (Rule Engine) | $0 | |
| C (NLG) | OpenAI GPT-3.5 Turbo | $0.001-0.002 | |
| **총계** | | | **$0.011-0.022** |

**월 1,000건 기준**: 약 **$11-22/월**

### 조합 3: 최고 품질 (비용 높음)

| 단계 | 모델 | 비용 (1회 요청) | 총 비용 |
|------|------|----------------|---------|
| A (Vision) | OpenAI GPT-4o | $0.10-0.20 | |
| B (Mapping) | 규칙 엔진 (Rule Engine) | $0 | |
| C (NLG) | OpenAI GPT-4o | $0.01-0.02 | |
| **총계** | | | **$0.11-0.22** |

**월 1,000건 기준**: 약 **$110-220/월**

---

## 비용 절감 전략

### 1. 캐싱 전략
- **단계 B (Mapping)**: 동일한 `skin_condition_scores`에 대해 결과 캐싱
- **단계 C (NLG)**: 유사한 케이스에 대해 템플릿 기반 생성 (LLM 호출 최소화)

### 2. 배치 처리
- 여러 이미지를 한 번에 처리 (단계 A)
- 유사한 케이스를 그룹화하여 처리 (단계 C)

### 3. 품질 게이트
- 낮은 신뢰도(confidence < 0.3) 케이스는 LLM 호출 스킵 → 규칙 기반 폴백
- 불확실성 높은 케이스(uncertainty > 0.5)는 간단한 템플릿 사용

### 4. 프롬프트 최적화
- 최소한의 토큰으로 최대 효과
- 시스템 프롬프트 최적화
- 출력 형식 명확히 지정 (JSON 구조화)

### 5. 모델 선택 전략
- **단계 A**: Gemini 1.5 Pro (Vision) - 이미지 분석 필수
- **단계 B**: 규칙 엔진 (무료) - LLM 불필요
- **단계 C**: Gemini 1.5 Flash - 텍스트 생성만 필요

---

## 구현 우선순위

### Phase 1: 최저 비용 조합 (MVP)
1. **단계 A**: Google Gemini 1.5 Pro (Vision) 연동
2. **단계 B**: 규칙 엔진 구현 (JavaScript/TypeScript)
3. **단계 C**: Google Gemini 1.5 Flash 연동

**예상 비용**: 월 1,000건 기준 **$10-20/월**

### Phase 2: 품질 개선 (필요시)
1. **단계 A**: 품질 검증 및 프롬프트 최적화
2. **단계 B**: 통계 기반 가중치 추가 (ML 모델 없이)
3. **단계 C**: 프롬프트 최적화 및 템플릿 활용

### Phase 3: 고급 기능 (선택사항)
1. **단계 A**: Heatmap 생성 기능 추가
2. **단계 B**: ML 기반 가중치 (XGBoost 등)
3. **단계 C**: 개인화된 문구 생성

---

## 예상 비용 (월간)

### 시나리오 1: 소규모 (100건/월)
- **조합 1 (최저 비용)**: $1-2/월
- **조합 2 (균형)**: $1.1-2.2/월
- **조합 3 (최고 품질)**: $11-22/월

### 시나리오 2: 중규모 (1,000건/월)
- **조합 1 (최저 비용)**: $10-20/월
- **조합 2 (균형)**: $11-22/월
- **조합 3 (최고 품질)**: $110-220/월

### 시나리오 3: 대규모 (10,000건/월)
- **조합 1 (최저 비용)**: $100-200/월
- **조합 2 (균형)**: $110-220/월
- **조합 3 (최고 품질)**: $1,100-2,200/월

---

## 결론

**최종 추천: 조합 1 (최저 비용)**
- **단계 A**: Google Gemini 1.5 Pro (Vision)
- **단계 B**: 규칙 엔진 (Rule Engine)
- **단계 C**: Google Gemini 1.5 Flash

**이유:**
1. 비용 효율적 (월 1,000건 기준 $10-20)
2. 품질 충분 (MVP 단계에서 사용 가능)
3. 확장 가능 (나중에 모델 업그레이드 가능)
4. 제어 가능 (규칙 엔진으로 완전한 제어)

**다음 단계:**
1. Google Gemini API 키 발급
2. 단계 A, B, C 서비스 구현
3. 비용 모니터링 및 최적화

