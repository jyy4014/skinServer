# 테스트 커버리지 분석 및 개선 계획

## 📊 현재 테스트 상태

### ✅ 완료된 테스트
1. **ProgressLoader** - 14개 테스트, 100% 커버리지
2. **RadarChart** - 11개 테스트, 100% 커버리지
3. **ProgressBar** - 기존 테스트 있음

### ⚠️ 부족한 테스트

#### 1. 핵심 기능 테스트 부족
- ❌ **useAnalysisFlow 훅** - 전체 분석 플로우 오케스트레이션 (가장 중요!)
- ❌ **ResultView 컴포넌트** - 분석 결과 표시
- ❌ **AnalyzePage** - 테스트 코드는 있지만 실행 안됨
- ❌ **useImageUpload 훅** - 이미지 업로드 로직
- ❌ **useAnalysis 훅** - AI 분석 호출
- ❌ **useAnalysisSave 훅** - 결과 저장

#### 2. 에러 처리 테스트 부족
- ❌ 네트워크 에러 시나리오
- ❌ API 에러 시나리오
- ❌ 이미지 크기 초과 에러
- ❌ 인증 에러
- ❌ 재시도 로직 테스트

#### 3. 엣지 케이스 테스트 부족
- ❌ 빈 이미지 배열
- ❌ 잘못된 이미지 형식
- ❌ 매우 큰 이미지
- ❌ 네트워크 타임아웃
- ❌ 부분 실패 시나리오 (일부 이미지만 업로드 성공)

#### 4. 통합 테스트 부족
- ❌ 전체 분석 플로우 (업로드 → 분석 → 저장)
- ❌ 에러 발생 시 복구 플로우
- ❌ 진행도 업데이트 플로우

#### 5. E2E 테스트 부족
- ❌ 실제 브라우저에서 전체 플로우
- ❌ 사용자 인터랙션 시나리오

---

## 🎯 우선순위별 추가 테스트 계획

### 🔥 P0: 핵심 기능 테스트 (즉시 필요)

#### 1. useAnalysisFlow 훅 테스트 ⭐ **최우선**
**중요도**: ⭐⭐⭐⭐⭐

**테스트해야 할 것**:
- [ ] 정상 플로우 (업로드 → 분석 → 저장)
- [ ] 진행도 업데이트 (각 단계별)
- [ ] 에러 발생 시 처리
- [ ] 재시도 로직
- [ ] 여러 이미지 처리 (1개, 2개, 3개)
- [ ] 각도 배열 생성 로직

**예상 시간**: 2-3시간

---

#### 2. ResultView 컴포넌트 테스트
**중요도**: ⭐⭐⭐⭐

**테스트해야 할 것**:
- [ ] 분석 결과 표시
- [ ] 레이더 차트 렌더링
- [ ] 히트맵 토글
- [ ] 시술 추천 리스트 표시
- [ ] NLG 결과 표시
- [ ] 빈 데이터 처리
- [ ] 접근성

**예상 시간**: 1-2시간

---

#### 3. 에러 처리 테스트
**중요도**: ⭐⭐⭐⭐⭐

**테스트해야 할 것**:
- [ ] 네트워크 에러 분류 및 처리
- [ ] API 에러 분류 및 처리
- [ ] 이미지 검증 에러
- [ ] 재시도 버튼 표시/숨김
- [ ] 재시도 로직 실행
- [ ] 에러 메시지 표시

**예상 시간**: 2시간

---

### 🟡 P1: 통합 테스트 (단기)

#### 4. 전체 분석 플로우 통합 테스트
**중요도**: ⭐⭐⭐⭐

**테스트해야 할 것**:
- [ ] 이미지 선택 → 업로드 → 분석 → 결과 표시
- [ ] 에러 발생 시 복구
- [ ] 진행도 업데이트 확인
- [ ] 결과 저장 확인

**예상 시간**: 2-3시간

---

#### 5. useImageUpload 훅 테스트
**중요도**: ⭐⭐⭐

**테스트해야 할 것**:
- [ ] 단일 이미지 업로드
- [ ] 여러 이미지 업로드
- [ ] 진행도 콜백
- [ ] 에러 처리
- [ ] 각도 정보 포함

**예상 시간**: 1-2시간

---

#### 6. useAnalysis 훅 테스트
**중요도**: ⭐⭐⭐

**테스트해야 할 것**:
- [ ] 분석 API 호출
- [ ] 진행도 업데이트
- [ ] 응답 파싱
- [ ] 에러 처리

**예상 시간**: 1시간

---

### 🟢 P2: E2E 테스트 (중기)

#### 7. Playwright E2E 테스트
**중요도**: ⭐⭐⭐⭐

**테스트해야 할 것**:
- [ ] 회원가입 → 로그인 → 분석 → 결과 확인
- [ ] 이미지 업로드 플로우
- [ ] 에러 발생 시 재시도
- [ ] 히스토리 조회

**예상 시간**: 3-4시간

---

## 📋 즉시 추가해야 할 테스트

### 1. useAnalysisFlow 훅 테스트 (최우선)

```typescript
describe('useAnalysisFlow', () => {
  describe('정상 플로우', () => {
    it('이미지 업로드 → 분석 → 저장이 순차적으로 실행되어야 함', async () => {
      // 테스트 작성
    })
    
    it('각 단계별로 진행도가 업데이트되어야 함', async () => {
      // 테스트 작성
    })
  })
  
  describe('에러 처리', () => {
    it('업로드 실패 시 에러를 반환해야 함', async () => {
      // 테스트 작성
    })
    
    it('분석 실패 시 에러를 반환해야 함', async () => {
      // 테스트 작성
    })
  })
  
  describe('여러 이미지 처리', () => {
    it('1개 이미지 처리', async () => {})
    it('2개 이미지 처리', async () => {})
    it('3개 이미지 처리', async () => {})
  })
})
```

---

### 2. ResultView 컴포넌트 테스트

```typescript
describe('ResultView', () => {
  describe('렌더링', () => {
    it('분석 결과가 올바르게 표시되어야 함', () => {})
    it('레이더 차트가 표시되어야 함', () => {})
    it('시술 추천 리스트가 표시되어야 함', () => {})
  })
  
  describe('인터랙션', () => {
    it('히트맵 토글이 작동해야 함', () => {})
    it('시술 카드 클릭 시 상세 페이지로 이동해야 함', () => {})
  })
  
  describe('엣지 케이스', () => {
    it('빈 데이터 처리', () => {})
    it('부분 데이터 처리', () => {})
  })
})
```

---

### 3. 에러 처리 통합 테스트

```typescript
describe('에러 처리', () => {
  it('네트워크 에러 시 재시도 버튼이 표시되어야 함', () => {})
  it('재시도 버튼 클릭 시 분석이 다시 시작되어야 함', () => {})
  it('검증 에러는 재시도 버튼이 표시되지 않아야 함', () => {})
})
```

---

## 📊 목표 커버리지

### 현재
- ProgressLoader: 100% ✅
- RadarChart: 100% ✅
- **전체 평균**: 약 15-20% (추정)

### 목표
- **핵심 기능**: 80% 이상
- **전체 평균**: 60% 이상
- **중요 컴포넌트**: 90% 이상

---

## 🚀 실행 계획

### Week 1: P0 테스트 완성
1. useAnalysisFlow 훅 테스트 (2-3시간)
2. ResultView 컴포넌트 테스트 (1-2시간)
3. 에러 처리 테스트 (2시간)

### Week 2: P1 테스트 완성
4. 통합 테스트 (2-3시간)
5. useImageUpload 훅 테스트 (1-2시간)
6. useAnalysis 훅 테스트 (1시간)

### Week 3: P2 테스트 완성
7. Playwright E2E 테스트 (3-4시간)

---

## 💡 결론

**현재 테스트는 충분하지 않습니다.**

**부족한 부분**:
1. ⚠️ 핵심 기능 (useAnalysisFlow) 테스트 없음
2. ⚠️ 결과 표시 (ResultView) 테스트 없음
3. ⚠️ 에러 처리 통합 테스트 없음
4. ⚠️ 통합 테스트 없음
5. ⚠️ E2E 테스트 없음

**즉시 추가해야 할 것**:
1. **useAnalysisFlow 훅 테스트** (최우선)
2. **ResultView 컴포넌트 테스트**
3. **에러 처리 통합 테스트**

이 3가지만 추가해도 테스트 커버리지가 크게 향상됩니다.

